<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title> DB - Cadastro de Alimentos </title>

  <!-- Google fonts - Inter -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">

  <!-- CSS Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" />

  <!-- JavaScript Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="cadalim.css">
  <link rel="icon" type="imagem/png" href="/images/icon-db-removebg-preview.png" />

</head>

<body onload="init()">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark" id="navbar" style="background-color: #212529;">
    <div class="container" style="background-color: #212529">
  
      <a class="navbar-brand" href="frontend2.html" style="width: 25%;">
        <img class="w-25" src="images/newlogo.png" />
        <span>DietBoost</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-items"
              aria-controls="navbar-items" aria-expanded="false" aria-label="Toggle navigation">
        <i class="bi bi-list"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbar-items" style="margin-left: 100px">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0" style="justify-content: center!important;">
          <li class="nav-item">
            <a class="nav-link" href="usuario2.html">área do usuário</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="dicas2.html">dicas</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="noticias2.html">noticias</a>
          </li>
          <li class="nav-item">
            <a href="educacional2.html" class="nav-link">educacional</a>
          </li>
          <!-- <li class="nav-item">
            <a href="contatos/lista.html" class="nav-link">contatos</a>
          </li> -->
        </ul>
        <div><a class="btn btn-light" href="user.html">Perfil</a></div>
      </div>
    </div>
  </nav>
  <h1 style="margin-top: 20px; text-align: center;">Cadastro de Alimentos</h1>

  <div class="container">
    <div class="row">
      <div id="msg" class="col-sm-10 offset-sm-1 ">
        <!--<div class="alert alert-warning">Contato não encontrado.</div>-->
      </div>
    </div>

    <form id="form-alimento">
      <div class="form-group row">
        <div class="col-sm-6">
          <label for="inputId">Id</label>
          <input type="text" class="form-control" id="inputId" placeholder="ID" disabled>
        </div>
        <div class="col-sm-6">
          <label for="inputNome">Nome (*)</label>
          <input type="text" class="form-control" id="inputNome" required placeholder="Insira o nome">
        </div>
      </div>
      <div class="form-group row">
        <div class="col-sm-6">
          <label for="inputCalorias">KCalorias (*)</label>
          <input type="text" class="form-control" id="inputCalorias" required placeholder="Insira o valor energético">
        </div>
        <div class="col-sm-6">
          <label for="inputCarboidratos">Carboidratos (*)</label>
          <input type="text" class="form-control" id="inputCarboidratos" required
            placeholder="Insira a quantidade de Carboidratos">
        </div>
      </div>
      <div class="form-group row">
        <div class="col-sm-6">
          <label for="inputProteinas">Proteinas</label>
          <input type="text" class="form-control" id="inputProteinas" placeholder="Insira a quantidade de Proteinas">
        </div>
        <div class="col-sm-6">
          <label for="inputGorduras">Gorduras</label>
          <input type="text" class="form-control" id="inputGorduras" required
            placeholder="Insira a quantidade de Gorduras">
        </div>
      </div>
      <div class="form-group row">
        <div class="col-sm-4">
          <small>(*) Campos obrigatórios</small>
        </div>
      </div>
      <div class="form-group row">
        <div class="col-sm-12">
          <input type="button" class="btn btn-success" id="btnInsert" value="Inserir">
          <input type="button" class="btn btn-warning" id="btnUpdate" value="Alterar">
          <input type="button" class="btn btn-danger" id="btnDelete" value="Excluir">
          <input type="button" class="btn btn-secondary" id="btnClear" value="Limpar Dados">
          <a class="btn btn-info" href="calc.html">Ir para a calculadora</a>

        </div>
      </div>
    </form>

    <div class="row">
      <div class="col-sm-12">
        <table id="grid-alimentos" class="table table-striped">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Nome</th>
              <th scope="col">KCalorias</th>
              <th scope="col">Carboidratos</th>
              <th scope="col">Proteinas</th>
              <th scope="col">Gorduras</th>
            </tr>
          </thead>
          <tbody id="table-alimentos">
            <tr>
              <td scope="row">1</td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  <script src="cadalim.js"></script>
  <script>
    function exibeAlimentos() {
      // Remove todas as linhas do corpo da tabela
      $("#table-alimentos").html("");

      // Popula a tabela com os registros do banco de dados
      for (i = 0; i < db.data.length; i++) {
        let alimento = db.data[i];
        $("#table-alimentos").append(`<tr><td scope="row">${alimento.id}</td>
                                                <td>${alimento.nome}</td>
                                                <td>${alimento.calorias}</td>
                                                <td>${alimento.carboidratos}</td>
                                                <td>${alimento.proteinas}</td>
                                                <td>${alimento.gorduras}</td>
                                            </tr>`);
      }
    }

    function init() {
      // Adiciona funções para tratar os eventos 
      $("#btnInsert").click(function () {
        // Verfica se o formulário está preenchido corretamente
        if (!$('#form-alimento')[0].checkValidity()) {
          displayMessage("Preencha o formulário corretamente.");
          return;
        }

        // Obtem os valores dos campos do formulário
        let campoNome = $("#inputNome").val();
        let campoCalorias = $("#inputCalorias").val();
        let campoCarboidrato = $('#inputCarboidratos').val();
        let campoProteina = $("#inputProteinas").val();
        let campoGordura = $('#inputGorduras').val();
        let alimento = {
          nome: campoNome,
          calorias: campoCalorias,
          carboidratos: campoCarboidrato,
          proteinas: campoProteina,
          gorduras: campoGordura
        };

        insertAlimento(alimento);

        // Reexibe os alimentos
        exibeAlimentos();

        // Limpa o formulario
        $("#form-alimento")[0].reset();
      });

      // Intercepta o click do botão Alterar
      $("#btnUpdate").click(function () {
        // Obtem os valores dos campos do formulário
        let campoId = $("#inputId").val();
        if (campoId == "") {
          displayMessage("Selecione um alimento para ser alterado.");
          return;
        }
        let campoNome = $("#inputNome").val();
        let campoCalorias = $("#inputCalorias").val();
        let campoCarboidrato = $("#inputCarboidratos").val();
        let campoProteina = $("#inputProteinas").val();
        let campoGordura = $("#inputGorduras").val();
        let alimento = {
          nome: campoNome,
          calorias: campoCalorias,
          carboidratos: campoCarboidrato,
          proteinas: campoProteina,
          gorduras: campoGordura
        };

        updateAlimento(parseInt(campoId), alimento);

        // Reexibe os alimentos
        exibeAlimentos();

        // Limpa o formulario
        $("#form-alimento")[0].reset();
      });

      // Intercepta o click do botão Excluir
      $("#btnDelete").click(function () {
        let campoId = $("#inputId").val();
        if (campoId == "") {
          displayMessage("Selecione um alimento a ser excluído.");
          return;
        }
        deleteAlimento(parseInt(campoId));

        // Reexibe os alimentos
        exibeAlimentos();

        // Limpa o formulario
        $("#form-alimento")[0].reset();
      });

      // Intercepta o click do botão Listar Alimentos
      $("#btnClear").click(function () {
        $("#form-alimento")[0].reset();
      });

      // Oculta a mensagem de aviso após alguns segundos
      $('#msg').bind("DOMSubtreeModified", function () {
        window.setTimeout(function () {
          $(".alert").fadeTo(500, 0).slideUp(500, function () {
            $(this).remove();
          });
        }, 5000);
      });

      // Preenche o formulário quando o usuario clicar em uma linha da tabela 
      $("#grid-alimentos").on("click", "tr", function (e) {
        let linhaAlimento = this;
        colunas = linhaAlimento.querySelectorAll("td");

        $("#inputId").val(colunas[0].innerText);
        $("#inputNome").val(colunas[1].innerText);
        $("#inputCalorias").val(colunas[2].innerText);
        $("#inputCarboidratos").val(colunas[3].innerText);
        $("#inputProteinas").val(colunas[4].innerText);
        $("#inputGorduras").val(colunas[5].innerText);
      });

      exibeAlimentos();
    }
  </script>
</body>

</html>